15-01-2016 Backup van m'n KoekoekPi
De pi draait stabiel met de volgende installaties:
- webserver die onder een gebruiker draait met beperkte rechten
- vpn server met .ovpn key files
- ownCloud server
- ssh
- USB schijf gaat vanzelf slapen

Deze backup is gemaakt met het volgende commando:
# eerst de disk unmounten
# http://serverfault.com/questions/4906/using-dd-for-disk-cloning
sudo dd if=/dev/disk1 of=KoekoekPi.img bs=100m conv=notrunc # takes a few hours!
tar cvf - KoekoekPi.img | pigz -9 > KoekoekPi.img.tar.gz

# 2016 06 08
http://superuser.com/questions/841865/extracting-a-tar-gz-file-returns-this-does-not-look-like-a-tar-archive

# get disk info
diskutil list
diskutil unmountDisk /dev/disk3


# write fresh image
DISK=3; sudo date; diskutil unmountDisk /dev/disk${DISK} && pv 2016-11-25-raspbian-jessie-lite.img | sudo dd of=/dev/rdisk${DISK} bs=100M

# make backup
sudo date && diskutil list && read -p "Enter the disk NUMBER you want to backup and press [ENTER]: " DISK && diskutil unmountDisk /dev/disk${DISK} && sudo pv /dev/rdisk${DISK} | pigz -9 > KoekoekPi."$(date +%Y%m%d)".img.gz

# restore backup
DISK=3; sudo date ; diskutil unmountDisk /dev/disk${DISK} && gzip --decompress --stdout KoekoekPi.20170109.img.gz | pv -s 16G | sudo dd of=/dev/rdisk${DISK} bs=100M

